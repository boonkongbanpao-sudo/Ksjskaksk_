import discord, asyncio, random, string, time
from discord.ext import commands
from discord import app_commands
from discord.ui import View, Button, Modal, TextInput, Select
import random, string, time

TOKEN = "‡πÇ‡∏ó‡πÄ‡∏Å"

OWNER_ID = ‡πÑ‡∏≠‡∏î‡∏µ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ä‡πâ‡πÑ‡∏î‡πâ
LOG_INVITE_CHANNEL_ID = ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏ä‡∏¥‡∏ç
ANTI_ENABLED = False

intents = discord.Intents.all()
bot = commands.Bot(command_prefix="!", intents=intents)

# ---------------- LOCK OWNER ----------------
def is_owner_id(uid): return uid == OWNER_ID

@bot.check
async def only_owner(ctx):
    return ctx.author.id == OWNER_ID

    if interaction.user.id != OWNER_ID:
        return
# ---------------- INVITE TRACK ----------------
invite_cache = {}

@bot.event
async def on_ready():
    await bot.tree.sync()
    print(f"‡∏ö‡∏≠‡∏ó‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå -> {bot.user}")

@bot.event
async def on_member_join(member):
    invites_before = invite_cache.get(member.guild.id, [])
    invites_after = await member.guild.invites()
    invite_cache[member.guild.id] = invites_after

    for inv in invites_after:
        before = next((i for i in invites_before if i.code == inv.code), None)
        if before and inv.uses > before.uses:
            ch = member.guild.get_channel(LOG_INVITE_CHANNEL_ID)
            if ch:
                await ch.send(
                    f"üì• **‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏¥‡∏ç‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü**\n"
                    f"‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏¥‡∏ç: {inv.inviter} ({inv.inviter.id})\n"
                    f"‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡∏¥‡∏ç: {member} ({member.id})"
                )
            break

# ---------------- PURGE ----------------
@bot.tree.command(name="‡∏•‡∏ö", description="‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà = ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)")
@app_commands.describe(‡∏à‡∏≥‡∏ô‡∏ß‡∏ô="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö")
async def purge(interaction: discord.Interaction, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: int | None = None):
    if interaction.user.id != OWNER_ID:
        return  # ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

    await interaction.response.defer(ephemeral=True)
    limit = None if not ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô or ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <= 0 else ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
    deleted = await interaction.channel.purge(limit=limit)
    await interaction.followup.send(f"üßπ ‡∏•‡∏ö‡πÑ‡∏õ {len(deleted)} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", ephemeral=True)

# ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏®‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö
active_roles = {}  # message_id: {"role_id": id, "max_claim": n, "claimed": set()}

# ---------------- Modal ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô ----------------
class MaxClaimModal(Modal, title="‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏¢‡∏®"):
    max_claim = TextInput(label="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î", placeholder="‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç", required=True)

    def __init__(self, role_id, interaction):
        super().__init__()
        self.role_id = role_id
        self.interaction = interaction

    async def on_submit(self, interaction: discord.Interaction):
        try:
            max_count = int(self.max_claim.value)
        except:
            return await interaction.response.send_message("‚ùå ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", ephemer>
        # ‡∏™‡πà‡∏á Embed + ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö‡∏¢‡∏®
        role = interaction.guild.get_role(self.role_id)
        if not role:
            return await interaction.response.send_message("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡∏®", ephemeral=True)

        embed = discord.Embed(
            title=f"üéñÔ∏è ‡πÅ‡∏à‡∏Å‡∏¢‡∏®: {role.name}",
            description=f"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ: {max_count}",
            color=0x00ff00
        )
        embed.set_footer(text="‡∏£‡∏µ‡∏ö‡∏°‡∏≤‡∏Å‡∏î‡∏Å‡∏±‡∏ô‡∏ô‡πâ‡∏≤‡∏≠‡∏∏‡∏™‡πà‡∏≤‡πÅ‡∏à‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πÉ‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏á‡∏≠‡πÅ‡∏á‡πÄ‡∏î‡πâ‡∏≠‡∏°‡∏µ‡πÅ‡∏à‡∏Å‡∏≠‡∏µ‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏ï‡πà‡∏ô‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏≠>

        view = RoleClaimView(self.role_id, max_count)
        msg = await interaction.channel.send(embed=embed, view=view)

        # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å message_id
        active_roles[msg.id] = {"role_id": self.role_id, "max_claim": max_count, "claim>

        await interaction.response.send_message("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö‡∏¢‡∏®‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", ephemeral=True)

# ---------------- View + Dropdown ----------------
class RoleDropdown(Select):
    def __init__(self, roles, interaction):
        options = [discord.SelectOption(label=r.name, value=str(r.id)) for r in roles i>
        super().__init__(placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏®", min_values=1, max_values=1, options=opti>
        self.interaction = interaction

    async def callback(self, interaction: discord.Interaction):
        role_id = int(self.values[0])
        await interaction.response.send_modal(MaxClaimModal(role_id, self.interaction))

class RoleSelectView(View):
    def __init__(self, guild_roles, interaction):
        super().__init__(timeout=None)
        self.add_item(RoleDropdown(guild_roles, interaction))

# ---------------- ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö‡∏¢‡∏® ----------------
class RoleClaimView(View):
    def __init__(self, role_id, max_claim):
        super().__init__(timeout=None)
        self.role_id = role_id
        self.max_claim = max_claim

    @discord.ui.button(label="‡∏£‡∏±‡∏ö‡∏¢‡∏®", style=discord.ButtonStyle.success, custom_id="clai>
    async def claim_button(self, interaction: discord.Interaction, button: Button):
        msg_id = interaction.message.id
        data = active_roles.get(msg_id)
        if not data:
            return await interaction.response.send_message("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", ephemeral=>

        if interaction.user.id in data["claimed"]:
            return await interaction.response.send_message("‚ùå ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏®‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß", ephemera>

        if len(data["claimed"]) >= data["max_claim"]:
            return await interaction.response.send_message("‚ùå ‡∏¢‡∏®‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß", ephemeral=Tru>

        role = interaction.guild.get_role(data["role_id"])
        if not role:
            return await interaction.response.send_message("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏¢‡∏®", ephemeral=True)

        try:
            await interaction.user.add_roles(role)
        except discord.Forbidden:
            return await interaction.response.send_message("‚ùå ‡∏ö‡∏≠‡∏ó‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏°‡∏≠‡∏ö‡∏¢‡∏®", ephemer>

        data["claimed"].add(interaction.user.id)
       data["claimed"].add(interaction.user.id)
        await interaction.response.send_me

# ---------------- Command ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Dropdown ----------------
@bot.tree.command(name="‡∏£‡∏±‡∏ö‡∏¢‡∏®", description="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏®‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡∏î‡∏£‡∏±‡∏ö")
async def receive_role(interaction: discord.Interaction):
    if interaction.user.id != OWNER_ID:
        return await interaction.response.send_message("‚ùå ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", ephemeral=True)
    guild_roles = interaction.guild.roles
    view = RoleSelectView(guild_roles, interaction)
    await interaction.response.send_message("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏®‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏Å‡∏î‡∏£‡∏±‡∏ö:", view=view, ephemeral=>
#-----------------‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏¢‡∏¥‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏ä‡πâ‡∏¢‡∏®------------------
@bot.tree.command(name="‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏¢‡∏¥‡∏á‡∏î‡∏¥‡∏™", description="‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏¢‡∏¥‡∏á‡∏î‡∏¥‡∏™‡πÑ‡∏°‡πà‡πÑ‡∏ä‡πâ‡∏¢‡∏®‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡∏Ñ‡∏∞‡πÉ‡∏ô‡πÄ‡∏ã‡∏¥‡∏ü‡∏£‡πå‡πÄ‡∏£‡∏≤")
async def anti(interaction: discord.Interaction):
    global ANTI_ENABLED
    ANTI_ENABLED = True
    await interaction.response.send_message(
        "‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ï‡πà‡∏≠‡∏ï‡πâ‡∏≤‡∏ô‡∏¢‡∏¥‡∏á‡∏î‡∏¥‡∏™‡πÅ‡∏•‡πâ‡∏ß",
        ephemeral=True
    )

@bot.event
async def on_message(message: discord.Message):
    global ANTI_ENABLED

    if not ANTI_ENABLED:
        await bot.process_commands(message)
        return

    # ‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ö‡∏≠‡∏ó‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
    if message.author.id == bot.user.id:
        return

    # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô webhook ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏≠‡∏ó‡∏≠‡∏∑‡πà‡∏ô ‚Üí ‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ
    if message.webhook_id or message.author.bot:
        try:
            await message.delete()
        except:
            pass
        return

    await bot.process_commands(message)

bot.run(TOKEN)
